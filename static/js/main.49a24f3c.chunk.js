(this.webpackJsonpcomp426final=this.webpackJsonpcomp426final||[]).push([[0],{248:function(e,t,n){},369:function(e,t){},411:function(e,t){},449:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(18),o=n.n(i),c=(n(248),n(238)),s=n(21),l=n(24),d=n(61),u=n(38),h=n(82),j=n(81),m=n(479),p=n(483),g=n(484),b=n(485),x=n(486),f=n(495),v=n(488),O=n(6),y=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).login=function(){var e=a.state,t=e.email,n=e.room;t&&n&&a.props.history.push("chat",{room:n,email:t})},a.handleChange=function(e){a.setState(Object(l.a)({},e.target.name,e.target.value))},a.state={email:"",room:""},a}return Object(u.a)(n,[{key:"render",value:function(){var e=this.state,t=e.email,n=e.room;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(m.a,{style:k.header,elevation:10,children:Object(O.jsx)(p.a,{children:Object(O.jsx)(g.a,{variant:"h6",children:"Chat App with Twilio Programmable Chat and React"})})}),Object(O.jsx)(b.a,{style:k.grid,container:!0,direction:"column",justify:"center",alignItems:"center",children:Object(O.jsxs)(x.a,{style:k.card,elevation:10,children:[Object(O.jsx)(b.a,{item:!0,style:k.gridItem,children:Object(O.jsx)(f.a,{name:"email",required:!0,style:k.textField,label:"Email address",placeholder:"Enter email address",variant:"outlined",type:"email",value:t,onChange:this.handleChange})}),Object(O.jsx)(b.a,{item:!0,style:k.gridItem,children:Object(O.jsx)(f.a,{name:"room",required:!0,style:k.textField,label:"Room",placeholder:"Enter room name",variant:"outlined",value:n,onChange:this.handleChange})}),Object(O.jsx)(b.a,{item:!0,style:k.gridItem,children:Object(O.jsx)(v.a,{color:"primary",variant:"contained",style:k.button,onClick:this.login,children:"Login"})})]})})]})}}]),n}(r.a.Component),k={header:{},grid:{position:"absolute",top:0,left:0,right:0,bottom:0},card:{padding:40},textField:{width:300},gridItem:{paddingTop:12,paddingBottom:12},button:{width:300}},w=y,C=n(45),I=n(9),T=n.n(I),S=n(73),B=n(490),F=n(496),M=n(491),D=n(492),E=n(487),A=n(493),L=n(494),R=n(155),q=n.n(R),z=n(489),U=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var e=this.props,t=e.message,n=e.email,a=t.author===n;return Object(O.jsxs)(z.a,{style:W.listItem(a),children:[Object(O.jsx)("div",{style:W.author,children:t.author}),Object(O.jsxs)("div",{style:W.container(a),children:[t.body,Object(O.jsx)("div",{style:W.timestamp,children:new Date(t.dateCreated.toISOString()).toLocaleString()})]})]})}}]),n}(r.a.Component),W={listItem:function(e){return{flexDirection:"column",alignItems:e?"flex-end":"flex-start"}},container:function(e){return{maxWidth:"75%",borderRadius:12,padding:16,color:"white",fontSize:12,backgroundColor:e?"#054740":"#262d31"}},author:{fontSize:10,color:"gray"},timestamp:{fontSize:8,color:"white",textAlign:"right",paddingTop:4}},J=U,N=n(274),P=function(e){Object(h.a)(n,e);var t=Object(j.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).componentDidMount=Object(S.a)(T.a.mark((function e(){var t,n,r,i,o,c,s,l,d;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.location,n=(t||{}).state,i=(r=n||{}).email,o=r.room,c="",i&&o||a.props.history.replace("/"),e.prev=5,e.next=8,a.getToken(i);case 8:c=e.sent,e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(5),new Error("Unable to get token, please reload this page");case 14:return e.next=16,N.Client.create(c);case 16:return(s=e.sent).on("tokenAboutToExpire",Object(S.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getToken(i);case 2:t=e.sent,s.updateToken(t);case 4:case"end":return e.stop()}}),e)})))),s.on("tokenExpired",Object(S.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getToken(i);case 2:t=e.sent,s.updateToken(t);case 4:case"end":return e.stop()}}),e)})))),s.on("channelJoined",function(){var e=Object(S.a)(T.a.mark((function e(t){var n;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getMessages();case 2:n=e.sent,a.setState({messages:n.items||[]}),a.scrollToBottom();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.prev=20,e.next=23,s.getChannelByUniqueName(o);case 23:l=e.sent,a.joinChannel(l),e.next=39;break;case 27:return e.prev=27,e.t1=e.catch(20),e.prev=29,e.next=32,s.createChannel({uniqueName:o,friendlyName:o});case 32:d=e.sent,a.joinChannel(d),e.next=39;break;case 36:throw e.prev=36,e.t2=e.catch(29),new Error("Unable to create channel, please reload this page");case 39:case"end":return e.stop()}}),e,null,[[5,11],[20,27],[29,36]])}))),a.getToken=function(){var e=Object(S.a)(T.a.mark((function e(t){var n,a,r,i;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"production",e.next=4,q.a.get("http://18.215.154.83/token/".concat(t));case 4:return n=e.sent,a=n.data,e.abrupt("return",a.token);case 9:return e.next=11,q.a.get("http://0.0.0.0:5000/token/".concat(t));case 11:return r=e.sent,i=r.data,e.abrupt("return",i.token);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.joinChannel=function(){var e=Object(S.a)(T.a.mark((function e(t){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"===t.channelState.status){e.next=3;break}return e.next=3,t.join();case 3:a.setState({channel:t,loading:!1}),t.on("messageAdded",a.handleMessageAdded),a.scrollToBottom();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleMessageAdded=function(e){var t=a.state.messages;a.setState({messages:[].concat(Object(C.a)(t),[e])},a.scrollToBottom)},a.scrollToBottom=function(){var e=a.scrollDiv.current.scrollHeight-a.scrollDiv.current.clientHeight;a.scrollDiv.current.scrollTop=e>0?e:0},a.sendMessage=function(){var e=a.state,t=e.text,n=e.channel;t&&(a.setState({loading:!0}),n.sendMessage(String(t).trim()),a.setState({text:"",loading:!1}))},a.state={text:"",messages:[],loading:!1,channel:null},a.scrollDiv=r.a.createRef(),a}return Object(u.a)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.loading,a=t.text,r=t.messages,i=t.channel,o=(this.props.location||{}).state||{},c=o.email,s=o.room;return Object(O.jsxs)(B.a,{component:"main",maxWidth:"md",children:[Object(O.jsx)(F.a,{open:n,style:{zIndex:99999},children:Object(O.jsx)(M.a,{style:{color:"white"}})}),Object(O.jsx)(m.a,{elevation:10,children:Object(O.jsx)(p.a,{children:Object(O.jsx)(g.a,{variant:"h6",children:"Room: ".concat(s,", User: ").concat(c)})})}),Object(O.jsx)(D.a,{}),Object(O.jsxs)(b.a,{container:!0,direction:"column",style:G.mainGrid,children:[Object(O.jsx)(b.a,{item:!0,style:G.gridItemChatList,ref:this.scrollDiv,children:Object(O.jsx)(E.a,{dense:!0,children:r&&r.map((function(e){return Object(O.jsx)(J,{message:e,email:c},e.index)}))})}),Object(O.jsx)(b.a,{item:!0,style:G.gridItemMessage,children:Object(O.jsxs)(b.a,{container:!0,direction:"row",justify:"center",alignItems:"center",children:[Object(O.jsx)(b.a,{item:!0,style:G.textFieldContainer,children:Object(O.jsx)(f.a,{required:!0,style:G.textField,placeholder:"Enter message",variant:"outlined",multiline:!0,rows:2,value:a,disabled:!i,onChange:function(t){return e.setState({text:t.target.value})}})}),Object(O.jsx)(b.a,{item:!0,children:Object(O.jsx)(A.a,{style:G.sendButton,onClick:this.sendMessage,disabled:!i,children:Object(O.jsx)(L.a,{style:G.sendIcon})})})]})})]})]})}}]),n}(r.a.Component),G={textField:{width:"100%",borderWidth:0,borderColor:"transparent"},textFieldContainer:{flex:1,marginRight:12},gridItem:{paddingTop:12,paddingBottom:12},gridItemChatList:{overflow:"auto",height:"70vh"},gridItemMessage:{marginTop:12,marginBottom:12},sendButton:{backgroundColor:"#3f51b5"},sendIcon:{color:"white"},mainGrid:{paddingTop:100,borderWidth:1}},H=P;var K=function(){return Object(O.jsx)(c.a,{children:Object(O.jsxs)(s.c,{children:[Object(O.jsx)(s.a,{exact:!0,path:"/chat",component:H}),Object(O.jsx)(s.a,{path:"/",component:w})]})})};var Q=function(){return Object(O.jsx)(K,{})},V=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,498)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),a(e),r(e),i(e),o(e)}))};o.a.render(Object(O.jsx)(r.a.StrictMode,{children:Object(O.jsx)(Q,{})}),document.getElementById("root")),V()}},[[449,1,2]]]);
//# sourceMappingURL=main.49a24f3c.chunk.js.map